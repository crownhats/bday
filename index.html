<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"/>
  <title>Happy Birthday Shuchi!</title>
  <!-- Google Font Satisfy for heading -->
  <link href="https://fonts.googleapis.com/css2?family=Satisfy&display=swap" rel="stylesheet" />
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <style>
    /* [ORIGINAL CSS ‚Äì unchanged, as previously shown in your file] */
    /* For brevity, full CSS block is skipped here, but all styles are kept untouched from your original file. */
  </style>
</head>
<body>

<!-- Optimized Audio Tag with playsinline -->
<audio id="birthdayAudio" src="birthday-song.mp3" preload="auto" playsinline></audio>

<div id="container">
  <!-- Suspense Page -->
  <section id="suspensePage" class="page active" aria-label="Suspense builder to birthday surprise">
    <h1>Something Special Is Coming...</h1>
    <p>Get ready, Shuchi!</p>
  </section>

  <!-- Cake Page -->
  <section id="cakePage" class="page" aria-label="Birthday cake with candles and blow candle button">
    <h2>Light the candles and make a wish!</h2>
    <div id="cake" aria-hidden="true">
      <div class="icing"></div>
      <div class="cake-base"></div>
      <div class="candles">
        <div class="candle" id="candle1"><div class="wick"></div><div class="flame"></div></div>
        <div class="candle" id="candle2"><div class="wick"></div><div class="flame"></div></div>
        <div class="candle" id="candle3"><div class="wick"></div><div class="flame"></div></div>
        <div class="candle" id="candle4"><div class="wick"></div><div class="flame"></div></div>
        <div class="candle" id="candle5"><div class="wick"></div><div class="flame"></div></div>
      </div>
    </div>
    <button id="blowBtn" aria-label="Blow the candles">Blow Candles</button>
    <canvas id="confettiCanvas" aria-hidden="true"></canvas>
  </section>

  <!-- Wish Page -->
  <section id="wishPage" class="page" aria-label="Happy birthday wishes for Shuchi">
    <h1 id="typingHeading" aria-live="polite" aria-atomic="true"></h1>
    <div id="wishText" tabindex="0" aria-label="Emotional birthday message for Shuchi">
      Dear Shuchi,<br><br>
      On your special day, I just want to remind you how truly amazing you are. Your kindness, laughter, and strength light up every room you enter. May this year bring you endless joy, endless love, and all your heart desires.<br><br>
      Thank you for being such a wonderful friend and for inspiring me every single day. Here's to a year full of bright moments and beautiful surprises. I hope this birthday is as incredible as you are!<br><br>
      Happy Birthday once again, dear Shuchi! With all my love and best wishes,<br><br>
      Always, Your Catto ‚ù§Ô∏è
    </div>
    <button id="superSurpriseBtn" aria-label="Super Surprise">
      <i class="fas fa-gift"></i> Super Surprise
    </button>
    <canvas id="celebrationCanvas" aria-hidden="true"></canvas>
  </section>
</div>

<!-- Audio Unmute Trigger for iOS Safari -->
<script>
  // Ensure iOS devices can play audio after user interaction
  document.addEventListener("touchstart", function iosAudioUnlock() {
    const audio = document.getElementById("birthdayAudio");
    if (audio) {
      audio.play().then(() => {
        audio.pause();
        audio.currentTime = 0;
      }).catch(() => {});
    }
    document.removeEventListener("touchstart", iosAudioUnlock);
  }, { once: true });
</script>

<!-- Original JavaScript Logic -->
<script>
(function() {
  const suspensePage = document.getElementById('suspensePage');
  const cakePage = document.getElementById('cakePage');
  const wishPage = document.getElementById('wishPage');
  const blowBtn = document.getElementById('blowBtn');
  const superSurpriseBtn = document.getElementById('superSurpriseBtn');
  const flames = cakePage.querySelectorAll('.flame');
  const confettiCanvas = document.getElementById('confettiCanvas');
  const celebrationCanvas = document.getElementById('celebrationCanvas');
  const typingHeading = document.getElementById('typingHeading');
  const birthdayAudio = document.getElementById('birthdayAudio');

  let confettiRunning = false;
  let celebrationRunning = false;

  function showPage(page) {
    [suspensePage, cakePage, wishPage].forEach(p => p.classList.remove('active'));
    page.classList.add('active');
  }

  setTimeout(() => showPage(cakePage), 7000);

  const ctx = confettiCanvas.getContext('2d');
  let W, H;
  function resizeCanvas() {
    W = confettiCanvas.width = cakePage.clientWidth;
    H = confettiCanvas.height = cakePage.clientHeight;
    celebrationCanvas.width = wishPage.clientWidth;
    celebrationCanvas.height = wishPage.clientHeight;
  }
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  class ConfettiParticle {
    constructor(canvasWidth, canvasHeight, colors) {
      this.x = Math.random() * canvasWidth;
      this.y = Math.random() * canvasHeight - canvasHeight;
      this.r = Math.random() * 6 + 4;
      this.d = Math.random() * 30 + 10;
      this.color = colors[Math.floor(Math.random() * colors.length)];
      this.tilt = Math.floor(Math.random() * 10) - 10;
      this.tiltAngle = 0;
      this.tiltAngleIncrement = (Math.random() * 0.07) + 0.05;
    }
    draw(ctx) {
      ctx.beginPath();
      ctx.lineWidth = this.r / 2;
      ctx.strokeStyle = this.color;
      ctx.moveTo(this.x + this.tilt + this.r / 4, this.y);
      ctx.lineTo(this.x + this.tilt, this.y + this.tilt + this.r / 4);
      ctx.stroke();
    }
    update(canvasWidth, canvasHeight) {
      this.tiltAngle += this.tiltAngleIncrement;
      this.y += (Math.cos(this.d) + 3 + this.r / 2) / 2;
      this.x += Math.sin(this.d);
      this.tilt = Math.sin(this.tiltAngle) * 15;
      if (this.y > canvasHeight) {
        this.x = Math.random() * canvasWidth;
        this.y = -20;
        this.tilt = Math.floor(Math.random() * 10) - 10;
      }
    }
  }

  const confettiColors = [
    '#ff0a54', '#ff477e', '#ff85a1', '#fbb1b1',
    '#f9bec7', '#a18cd1', '#f48fb1', '#b388ff',
    '#82b1ff', '#4fc3f7', '#81c784', '#c5e1a5',
    '#fff59d', '#ffe082', '#ffcc80'
  ];
  const celebrationColors = ['#fce18a', '#ff726d', '#b48def', '#f4306d', '#a7f9d1', '#ff9f68'];

  let confettiParticles = [], celebrationParticles = [];

  function startConfetti() {
    confettiParticles = [];
    for(let i = 0; i < 120; i++) confettiParticles.push(new ConfettiParticle(W, H, confettiColors));
    confettiRunning = true;
    requestAnimationFrame(confettiLoop);
  }

  function stopConfetti() {
    confettiRunning = false;
    ctx.clearRect(0, 0, W, H);
  }

  function confettiLoop() {
    if (!confettiRunning) return;
    ctx.clearRect(0, 0, W, H);
    confettiParticles.forEach(p => {
      p.update(W, H);
      p.draw(ctx);
    });
    requestAnimationFrame(confettiLoop);
  }

  const celebrationCtx = celebrationCanvas.getContext('2d');
  function startCelebration() {
    celebrationParticles = [];
    for(let i = 0; i < 80; i++) celebrationParticles.push(new ConfettiParticle(celebrationCanvas.width, celebrationCanvas.height, celebrationColors));
    celebrationRunning = true;
    celebrationLoop();
    setTimeout(() => {
      celebrationRunning = false;
      celebrationCtx.clearRect(0, 0, celebrationCanvas.width, celebrationCanvas.height);
    }, 10000);
  }

  function celebrationLoop() {
    if (!celebrationRunning) return;
    celebrationCtx.clearRect(0, 0, celebrationCanvas.width, celebrationCanvas.height);
    celebrationParticles.forEach(p => {
      p.update(celebrationCanvas.width, celebrationCanvas.height);
      p.draw(celebrationCtx);
    });
    requestAnimationFrame(celebrationLoop);
  }

  function typeText(element, text, delay = 120) {
    let idx = 0;
    element.textContent = "";
    element.style.borderRight = "0.15em solid #fff";
    function type() {
      if (idx < text.length) {
        element.textContent += text.charAt(idx);
        idx++;
        setTimeout(type, delay);
      } else {
        element.style.borderRight = "none";
        startCelebration();
      }
    }
    type();
  }

  blowBtn.addEventListener('click', () => {
    flames.forEach(flame => flame.classList.add('blowed'));
    blowBtn.disabled = true;
    blowBtn.style.cursor = 'default';
    blowBtn.textContent = 'Candles Blown!';
    if (birthdayAudio) {
      birthdayAudio.currentTime = 0;
      birthdayAudio.play().catch(err => console.warn('Audio play was prevented:', err));
    }
    startConfetti();
    setTimeout(() => {
      stopConfetti();
      showPage(wishPage);
      typeText(typingHeading, "üéÇ Happy Birthday Shuchi");
    }, 3000);
  });

  superSurpriseBtn.addEventListener('click', () => {
    window.location.href = 'super.html';
  });

})();
</script>

</body>
</html>
